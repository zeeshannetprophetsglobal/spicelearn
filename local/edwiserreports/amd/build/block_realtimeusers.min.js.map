{"version":3,"sources":["block_realtimeusers.js"],"names":["define","$","cfg","common","liveUsersTable","panel","getPanel","panelBody","loader","table","listner","getOnlineUsersData","show","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","sesskey","done","response","destroy","hide","DataTable","language","searchPlaceholder","aaSorting","columnDefs","targets","className","orderable","drawCallback","addClass","bInfo","lengthChange","initComplete","usersCount","length","document","find","append","createRealtimeUsersBlock","fail","error","console","log","always","setTimeout","init","notifyListner"],"mappings":"AAAA,aAGAA,OAAO,CAAC,SAAU,qCAAsC,WAAY,yCAA0C,8CAA+C,SAAUC,EAAGC,EAAKC,GAC7K,IAAIC,EAAiB,KACjBC,EAAQH,EAAII,SAAS,mBACrBC,EAAYL,EAAII,SAAS,kBAAmB,QAC5CE,EAASP,EAAEM,EAAY,YACvBE,EAAQR,EAAEM,EAAY,WACtBG,EAAU,KAed,SAASC,IAEPR,EAAOK,OAAOI,KAAK,mBACnBX,EAAEY,KAAK,CACLC,IAAKZ,EAAIa,WACTC,KAAMd,EAAIe,YACVC,SAAUhB,EAAIiB,gBACdC,KAAM,CACJC,OAAQ,0BACRC,QAASrB,EAAEI,GAAOe,KAAK,cAExBG,KAAK,SAAUC,IAiBpB,SAAkCJ,GAC5BhB,EACFA,EAAeqB,WAEfjB,EAAOkB,OACPjB,EAAMG,QAGRR,EAAiBK,EAAMkB,UAAU,CAC/BP,KAAMA,EACNQ,SAAU,CACRC,kBAAmB,eAErBC,UAAW,CAAC,CAAC,EAAG,QAChBC,WAAY,CAAC,CACXC,QAAW,EACXC,UAAa,aACZ,CACDD,QAAW,EACXC,UAAa,eACZ,CACDD,QAAW,EACXC,UAAa,cACbC,WAAa,IAEfC,aAAc,WACZlC,EAAE,sCAAsCmC,SAAS,4BACjDnC,EAAE,sBAAsBmC,SAAS,6BAEnCC,OAAO,EACPC,cAAc,EACdC,aAAc,WACZ,IAAIC,EAAa,oEAAsEpB,EAAKqB,OAAS,WACrGxC,EAAEyC,UAAUC,KAAK,mBAAmBC,OAAOJ,MAjD7CK,CAAyBrB,EAASJ,QACjC0B,KAAK,SAAUC,GAChBC,QAAQC,IAAIF,KACXG,OAAO,WACRxC,EAAQ,iBACRyC,WAAWxC,EAAoB,MAE/BR,EAAOK,OAAOkB,KAAK,qBAgDvB,MAAO,CACL0B,KA7EF,SAAcC,GACZ3C,EAAU2C,EACV1C","sourcesContent":["/* eslint-disable no-console */\ndefine([\n    \"jquery\",\n    \"local_edwiserreports/defaultconfig\",\n    \"./common\",\n    \"local_edwiserreports/jquery.dataTables\",\n    \"local_edwiserreports/dataTables.bootstrap4\"\n], function($, cfg, common) {\n    var liveUsersTable = null;\n    var panel = cfg.getPanel(\"#liveusersblock\");\n    var panelBody = cfg.getPanel(\"#liveusersblock\", \"body\");\n    var loader = $(panelBody + \" .loader\");\n    var table = $(panelBody + \" .table\");\n    var listner = null;\n\n    /**\n     * Initialize\n     * @param {function} notifyListner Callback function\n     */\n    function init(notifyListner) {\n        listner = notifyListner;\n\n        getOnlineUsersData(); // Call first time\n    }\n\n    /**\n     * Get online users data\n     */\n    function getOnlineUsersData() {\n\n        // Show loader.\n        common.loader.show(\"#liveusersblock\");\n\n        $.ajax({\n            url: cfg.requestUrl,\n            type: cfg.requestType,\n            dataType: cfg.requestDataType,\n            data: {\n                action: 'get_liveusers_data_ajax',\n                sesskey: $(panel).data(\"sesskey\")\n            },\n        })\n            .done(function(response) {\n                createRealtimeUsersBlock(response.data);\n            })\n            .fail(function(error) {\n                console.log(error);\n            }).always(function() {\n                listner(\"realTimeUsers\");\n                setTimeout(getOnlineUsersData, 2 * 60 * 1000);\n\n                // Hide loader.\n                common.loader.hide(\"#liveusersblock\");\n\n            });\n    }\n\n    /**\n     * Create Datatable of the table\n     * @param {Object} data Datatable data\n     */\n    function createRealtimeUsersBlock(data) {\n        if (liveUsersTable) {\n            liveUsersTable.destroy();\n        } else {\n            loader.hide();\n            table.show();\n        }\n\n        liveUsersTable = table.DataTable({\n            data: data,\n            language: {\n                searchPlaceholder: \"Search User\"\n            },\n            aaSorting: [[1, 'asc']],\n            columnDefs: [\n                {\n                    \"targets\": 0,\n                    \"className\": \"text-left\"\n                },\n                {\n                    \"targets\": 1,\n                    \"className\": \"text-center\"\n                },\n                {\n                    \"targets\": 2,\n                    \"className\": \"text-center\",\n                    \"orderable\": false\n                }\n            ],\n            drawCallback: function() {\n                $('.dataTables_paginate > .pagination').addClass('pagination-sm pull-right');\n                $('.dataTables_filter').addClass('pagination-sm pull-right');\n            },\n            bInfo: false,\n            lengthChange: false,\n            initComplete: function() {\n                var usersCount = '<small class=\"ml-auto my-auto font-weight-bold\">LoggedIn Users : ' + data.length + '</small>';\n                $(document).find(\".rtblock-filter\").append(usersCount);\n            }\n        });\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});\n"],"file":"block_realtimeusers.min.js"}